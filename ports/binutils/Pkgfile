# Description: linker, assembler and other development tools
name=binutils
version=2.37
release=mix-2
source=(https://ftp.gnu.org/gnu/binutils/binutils-$version.tar.xz
	binutils-2.37-upstream_fix-1.patch
)

build() {
  cd $name-$version

  # upstream patch
  patch -Np1 -i ../binutils-2.37-upstream_fix-1.patch

  # remove shipped man pages
  sed -i '63d' etc/texi2pod.pl
  find -name \*.1 -delete

  mkdir -v build
  cd build

  ../configure --prefix=/usr \
    --enable-gold \
    --enable-ld=default \
    --enable-plugins \
    --enable-shared \
    --disable-werror \
    --enable-64-bit-bfd \
    --with-system-zlib
  make tooldir=/usr
  $TST make -k check || true
  make tooldir=/usr DESTDIR=$PKG install -j1
  rm -fv $PKG/usr/lib/lib{bfd,ctf,ctf-nobfd,opcodes}.a
  rm -rv $PKG/usr/share/info
}
