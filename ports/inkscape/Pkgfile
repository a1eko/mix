# Description: An open source SVG editor
# URL: https://www.inkscape.org/
# Maintainer: Tim Biermann, tbier at posteo dot de
# Depends on: boehm-gc boost double-conversion graphicsmagick gsl gtkmm3 libsoup libxslt poppler popt potrace
# Optional: libcdr libvisio libwpg

name=inkscape
version=1.4.3
release=mix-1
source=(https://media.inkscape.org/dl/resources/file/$name-$version.tar.xz
  7690.patch
  7691.patch
  7738.patch
)

build() {
  #mv inkscape-* inkscape-$version
  cd ${name}-${version}_*

  pkz -i list libcdr || PKGMK_INKSCAPE+=" -D WITH_LIBCDR=OFF"
  pkz -i list libvisio || PKGMK_INKSCAPE+=" -D WITH_LIBVISIO=OFF"
  pkz -i list libwpg || PKGMK_INKSCAPE+=" -D WITH_LIBWPG=OFF"

  #patch -Np1 -d $name-$version -i $SRC/7691.patch
  #patch -Np1 -d $name-$version -i $SRC/7690.patch
  #patch -Np1 -d $name-$version -i $SRC/7738.patch
  patch -Np1 -i $SRC/7738.patch

  #cmake -S $name-$version -B build -G Ninja $PKGMK_INKSCAPE \
  cmake -S . -B build -G Ninja $PKGMK_INKSCAPE \
    -D CMAKE_INSTALL_PREFIX=/usr \
    -D CMAKE_INSTALL_LIBDIR=lib \
    -D CMAKE_BUILD_TYPE=Release \
    -D CMAKE_CXX_FLAGS_RELEASE="$CXXFLAGS" \
    -D CMAKE_C_FLAGS_RELEASE="$CFLAGS" \
    -D WITH_INTERNAL_2GEOM=ON \
    -D BUILD_TESTING=OFF \
    -D WITH_NLS=OFF \
    -Wno-dev
  cmake --build build
  DESTDIR=$PKG cmake --install build

  rm -r $PKG/usr/share/man/?? \
    $PKG/usr/share/man/??_?? \
    $PKG/usr/share/inkscape/doc

  find $PKG/usr/share/inkscape \(\
    -name 'README' \
    -o -name 'README.*' \
    -o -name 'LICENSE.txt' \)\
    -delete

  pkz -i list bash-completion || rm -rf $PKG/usr/share/bash-completion

  /usr/bin/python3 -m compileall $PKG
  /usr/bin/python3 -O -m compileall $PKG
  /usr/bin/python3 -OO -m compileall $PKG
}
