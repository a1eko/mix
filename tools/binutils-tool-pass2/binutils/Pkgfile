# Description: linker, assembler and other development tools

name=binutils
version=2.30
release=0pass2
source=(ftp://ftp.gnu.org/gnu/binutils/binutils-$version.tar.bz2)

: ${MIX_TGT:=$(uname -m)-mix-linux-gnu}

build() {
  cd $name-$version
  mkdir -v build
  cd build

  # make linker using cross compiler and linker
  CC=$MIX_TGT-gcc AR=$MIX_TGT-ar RANLIB=$MIX_TGT-ranlib \
  ../configure --prefix=/tools \
    --with-lib-path=/tools/lib \
    --disable-nls \
    --disable-werror \
    --with-lib-path=/tools/lib \
    --with-sysroot
  make
  make DESTDIR=$PKG install
  rm -rv $PKG/tools/share/{info,man}

  # prepare linker for adjusting
  make -C ld clean
  make -C ld LIB_PATH=/usr/lib:/lib
  cp -v ld/ld-new $PKG/tools/bin/
}
